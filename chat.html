<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShadowGPT | Cid Kageno</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com" defer></script>

<style>
body { margin:0; font-family:sans-serif; background-color:#0f0f0f; color:white; }
.glass {
  background: rgba(30,30,30,0.6);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  border-radius: 18px;
  padding: 0.75rem 1rem;
  box-shadow: 0 4px 20px rgba(139,92,246,0.35);
}
#chat-container { flex:1; overflow-y:auto; padding:1rem; display:flex; flex-direction:column; gap:0.5rem; }
.user-msg { align-self:flex-end; background:linear-gradient(to right,#6366f1,#a855f7); color:white; border-radius:1rem 0 1rem 1rem; max-width:80%; }
.bot-msg { align-self:flex-start; background:rgba(139,92,246,0.2); border-radius:0 1rem 1rem 1rem; max-width:80%; }
input, button { font-family:sans-serif; }
input:focus { outline:none; border:2px solid #8b5cf6; }
.dot-flashing { width:8px; height:8px; border-radius:50%; background-color:#8b5cf6; animation:dotFlashing 1s infinite linear alternate; }
@keyframes dotFlashing {0%{background-color:#8b5cf6}50%,100%{background-color:transparent}}
.animate-fadeIn { animation: fadeIn 0.3s ease forwards; }
@keyframes fadeIn {0%{opacity:0;transform:translateY(5px);}100%{opacity:1;transform:translateY(0);}}
</style>
</head>

<body class="flex flex-col min-h-screen">

<!-- Header -->
<header class="p-4 text-center text-2xl font-bold glass mb-2">ShadowGPT Portal</header>

<!-- Chat Container -->
<main class="flex-1 flex flex-col px-4 py-2">
  <div id="chat-container">
    <div class="bot-msg glass animate-fadeIn p-3">Greetings, shadow walker. What knowledge do you seek from the void?</div>
  </div>

  <!-- Input Bar -->
  <div class="flex gap-2 mt-2">
    <input type="text" id="user-input" placeholder="Whisper to the shadows..." class="flex-1 px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg">
    <button id="send-btn" class="px-6 py-3 bg-violet-600 hover:bg-violet-700 rounded-lg font-medium flex items-center gap-2">Send</button>
  </div>
</main>

<!-- Footer -->
<footer class="text-center p-4 text-sm opacity-60 glass mt-2">Â© All rights reserved by Cid Kageno</footer>

<script>
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

const API_URL = "https://test-baby-file.vercel.app/chat";

// Smooth scroll to bottom
function scrollToBottom() {
  chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
}

// Add message to chat
function addMessage(sender, text, animateTyping=false){
  const div = document.createElement('div');
  div.className = sender==='user' ? 'user-msg glass animate-fadeIn p-3' : 'bot-msg glass animate-fadeIn p-3';
  chatContainer.appendChild(div);

  if(animateTyping){
    let i=0;
    const interval = setInterval(() => {
      div.textContent = text.slice(0,i+1) + (i<text.length-1?'|':'');
      scrollToBottom();
      i++;
      if(i>=text.length) clearInterval(interval);
    },30);
  } else {
    div.textContent = text;
    scrollToBottom();
  }
}

// Query AI
async function queryAI(message, userID="user123"){
  try{
    const res = await fetch(API_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ text: message, senderID: userID })
    });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    return data.reply || "The shadows are silent...";
  }catch(err){
    console.error(err);
    return "The shadows are disturbed... try again later.";
  }
}

// Send message handler
async function sendMessage(){
  const msg = userInput.value.trim();
  if(!msg) return;
  addMessage('user', msg);
  userInput.value='';

  // Show typing indicator
  const thinking = document.createElement('div');
  thinking.className='bot-msg glass animate-fadeIn p-3 flex gap-2';
  const dot = document.createElement('div'); dot.className='dot-flashing';
  thinking.appendChild(dot);
  chatContainer.appendChild(thinking);
  scrollToBottom();

  const response = await queryAI(msg);
  chatContainer.removeChild(thinking);
  addMessage('bot', response, true);
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });
</script>
</body>
</html>
